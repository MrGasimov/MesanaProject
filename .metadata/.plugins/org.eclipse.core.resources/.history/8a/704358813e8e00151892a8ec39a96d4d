package com.corvolution.mesana.rest;
import java.io.InputStream;

import org.apache.commons.httpclient.MultiThreadedHttpConnectionManager;
import org.apache.commons.io.IOUtils;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.StatusLine;
import org.apache.http.client.HttpClient;
import org.apache.http.client.config.RequestConfig;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpPut;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.impl.client.HttpClients;

import com.corvolution.mesana.configurator.PropertyManager;


public class RestApiConnector {
	final RequestConfig params = RequestConfig.custom().setConnectTimeout(3000).setSocketTimeout(3000).build();
	MultiThreadedHttpConnectionManager connectionManager = new MultiThreadedHttpConnectionManager();
	public static HttpClient httpclient = new HttpClient();
	
	PropertyManager conf = new PropertyManager();
	public String getMethod(String URL){
	
		HttpGet httpGet = new HttpGet(URL);
		//httpGet.setConfig(params);
		String json=null;
		try {

			HttpResponse response = httpclient.execute(httpGet);
			StatusLine statusLine = response.getStatusLine();
			int statusCode = statusLine.getStatusCode();

			if (statusCode == 200) {				
				HttpEntity entity = response.getEntity();
				InputStream inputStream = entity.getContent();
				json = IOUtils.toString(inputStream, "UTF-8");
				
			}

		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return json;
		
		
	}
		
	public void postMethod(String json, String url) throws Exception {		
		
		HttpPost httpPost = new HttpPost(url);
		//httpPost.setConfig(params);
		httpPost.addHeader("Content-Type", "application/json");
		
		httpPost.setEntity(new StringEntity(json));
		HttpResponse response = httpclient.execute(httpPost);
		if (response.getStatusLine().getStatusCode() != 200) {
			throw new RuntimeException("Failed : HTTP error code : " + response.getStatusLine().getStatusCode());
		} else {
			System.out.println(response.getStatusLine().getStatusCode());

		}

		
	}
	
	public void putMethod(String json, String url) throws Exception {		
		
		HttpPut httpPut = new HttpPut(url);
		httpPut.addHeader("Content-Type", "application/json");
		
		httpPut.setEntity(new StringEntity(json));
		System.out.println("some text before execution");
		HttpResponse response = httpclient.execute(httpPut);
		System.out.println("some text after execution");

		if (response.getStatusLine().getStatusCode() != 200) {
			throw new RuntimeException("Failed : HTTP error code : " + response.getStatusLine().getStatusCode());
		} else {
			System.out.println(response.getStatusLine().getStatusCode());
		}

		
	}
	}
