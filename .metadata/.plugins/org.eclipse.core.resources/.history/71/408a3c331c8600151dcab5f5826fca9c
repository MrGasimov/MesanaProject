package com.corvolution.cm2;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.List;
import org.apache.commons.io.FileUtils;

public class Sensor {
		public static   ;
		private String sensorPath;
		private String deviceName, manufacturerName, serialNumber,firmwareVersion, flashDate, sensorVoltage;		
			
		//construct sensor object
		public Sensor(String path) throws IOException{
			sensorPath = path;
			readSensorInfo(path);
			String fileName =":/config.txt" ;
			readConfigFile(path, fileName);					
		}
			
		public String  getSensorPath(){			
			return sensorPath;			
		}
		
		public String getDeviceName(){
			return deviceName;	
		}
		
		public String getManufacturerName(){
			return manufacturerName;	
		}
		
		public String getSerialNumber(){
			return serialNumber;	
		}
		
		public String getFirmwareVersion(){
			return firmwareVersion;
		}
		
		public String getFlashDate(){
			return flashDate;
		}			
		public String getSensorVoltage(){			
			return sensorVoltage;
		}
		
		//read sensor info file from sensor
		public void readSensorInfo(String path) throws IOException{
			 String sensorInfo = ":/info.txt";					    		    
			 deviceName = readConfigFile(path,sensorInfo).get(0);
			 manufacturerName = readConfigFile(path,sensorInfo).get(1);
			 serialNumber = readConfigFile(path,sensorInfo).get(2);
			 firmwareVersion = readConfigFile(path,sensorInfo).get(3);
			 flashDate =  readConfigFile(path,sensorInfo).get(4);					
		}
		
		
		//read configuration file from sensor
		public List<String> readConfigFile(String sensorPath,String fileName) throws IOException{
			
			BufferedReader reader = new BufferedReader( new FileReader(sensorPath+ fileName));
			String line = null;
			List<String> list = new ArrayList<String>();		
		    while( ( line = reader.readLine() ) != null ) {	    
		    	list.add(line);        	        
		    }	
		    
		    reader.close();
		    return list;
		}
		
		//create new configuration object for writing to sensor
		public SensorConfiguration newConfigFile(){			
			SensorConfiguration configObject = new SensorConfiguration();
			String rate = PropertyManager.getProperty("ECG_SAMPLE_RATE")+ PropertyManager.getProperty("ACC_SAMPLE_RATE")+PropertyManager.getProperty("TEMP_SAMPLE_RATE")+PropertyManager.getProperty("IMP_SAMPLE_RATE");
			configObject.setLinkId("23423");
			System.out.println(configObject.getLinkId());
			System.out.println(rate);				
			configObject.setSampleRate(rate);
			return configObject;	
		}
		
		//write configuration file to sensor
		public void writeConfigFile() throws IOException{
			
			String configContent = newConfigFile().getLinkId() + "\r\n" + newConfigFile().getSampleRate();
			System.out.println(configContent+" config content");
			Files.write(Paths.get(sensorPath+":/config.txt"), configContent.getBytes());
			File source = new File(sensorPath+":/confige.txt");					   
		}
		
		//read measurement data from sensor		
		public void readMeasurementFromSensor(){			
			File source =  new File(sensorPath+":/project");
			File dest = new File(PropertyManager.getProperty("READOUT_DEST"));
				
			try {
				FileUtils.copyDirectoryToDirectory(source,dest);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		 
		}
		
		public int sizeOfData(){
			int size = FileUtils.sizeOf(new File(sensorPath+":/project"));
		}
		

}
